FROM alpine:3.3

MAINTAINER Martin Etmajer <martin.etmajer@dynatrace.com>

ENV VERSION             "6.2"
ENV INSTALLER_FILE_NAME "dynatrace-wsagent-linux-x64.tar"
ENV INSTALLER_URL       "http://downloads.dynatracesaas.com/${VERSION}/${INSTALLER_FILE_NAME}"

ENV DT                  "/dynatrace"
ENV BIN64               "${DT}/agent/lib64/dtwsagent"
ENV INI                 "${DT}/agent/conf/dtwsagent.ini"
ENV LIB64               "${DT}/agent/lib64/libdtagent.so"
ENV SLAVE_AGENT_PORT    "8001"

ENV  DT_INSTALL_DEPS "curl openjdk8-jre-base"
RUN  apk add --no-cache ${DT_INSTALL_DEPS} && \
     curl -L -o /tmp/${INSTALLER_FILE_NAME} ${INSTALLER_URL} && \
     cd /tmp && \
     tar xf ./${INSTALLER_FILE_NAME} && \
     sh ./dynatrace-wsagent-*.sh && \
     mv ./dynatrace-${VERSION} ${DT} && \
     apk del ${DT_INSTALL_DEPS} && \
     rm -rf /tmp/*
ADD  build/bin/dtnginx_offsets.json.tar.gz ${DT}/agent/conf
COPY build/scripts/run-wsagent-master.sh ${DT}

CMD while true; do sleep 1; done